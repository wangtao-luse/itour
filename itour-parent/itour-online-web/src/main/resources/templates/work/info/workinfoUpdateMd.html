@layout("/layout/template-css.html",{title:'爱旅行-写日志'}){
@if(has(error)){
<script>
    function showErrorMessage() {
        alert("${error!}");
    }
    showErrorMessage();
</script>
@}
		<link rel="stylesheet" href="${ctxPath}/md/css/editormd.min.css" />
		<script type="text/javascript" src="${ctxPath}/md/editormd.min.js" ></script>
		<script type="text/javascript" src="${ctxPath}/js/common/jquery.form.js" ></script>
		<script type="text/javascript" src="${ctxPath}/js/work/infoMd.js" ></script>
		<script>
		$(function(){
			var path=$("#article-summary-path").val();
			if(path){
				$(".form-cover-desc-box .select-cover__preview").css("background-image","url("+path.replace(/\\/g,"/")+")").css("display","block");
			}
			var articleType="${workInfo.articleType!}";
			var modality="${workInfo.modality!}";
			$("input:radio[value='"+modality+"']").prop('checked', true);

			$("#articleType").val(articleType);
			$(".modal-article-pushlish-wrp #js_description").trigger("keyup");
			//标签
			$(".mark_selection .el-tag").each(function(){
				var tag =$(this).text().trim();
				$(".mark_selection .tag__option-label").each(function(i,item){
					var text = $(this).find(".spanIsAgree").text().trim();
					if(tag==text){
						$(this).find(".tag__option-chk").prop("checked","checked");
					}
				})
				
			});
			//专栏
			$(".tag__box .tag__item-box").each(function(i,item){
				var  v= $(this).find(".tag__name").text();
				$(".tag__box .tag__option-label").each(function(i,item){
					var text = $(this).find(".spanIsAgree").text().trim();
					if(v==text){
						$(this).find(".tag__option-chk").prop("checked","checked");
					}
				});
			});
		})
		</script>
		<style>
		html,body{
             height: 100%;
          }
			.md-editor{
			 height: 100%;
			}
		 #footer{
		 	display: none;
		 }		
		</style>
		<style>
			
			.button, .text-input {
			    background-image: none;
			    border: 0;
			    border-radius: 4px;
			}
			.text-input {
			    display: block;
			    font-variant-ligatures: no-common-ligatures;
			    width: 100%;
			    height: 36px;
			    padding: 3px 12px;
			    font-size: inherit;
			    line-height: 1.5;
			    color: inherit;
			    background-color: #fff;
}
:focus {
    outline: none;
}
button {
    cursor: pointer;
}
		</style>
		<style>
			
		</style>

		<!--http://editor.md.ipandao.com/-->
		<div class="layou-panel">
			<div class="article-bar flex flex--row flex--align-center">
				<div class="article-bar__link-box">
					<a title="文章管理" class="btn-goback" href="${ctxPath}/work/index"> 
						<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="89px" height="17px" viewBox="0 0 89 17" version="1.1"><g id="页面1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="MD编辑器优化-20190916" transform="translate(-24.000000, -24.000000)" fill="#6B6B6B"><g id="Group-4" transform="translate(21.000000, 24.000000)"><path d="M11.2719767,13.1315385 C11.4864972,13.3286154 11.6239413,13.6086154 11.6239413,13.9230769 C11.6239413,14.5175385 11.1410006,15 10.5459486,15 C10.2651315,15 10.0118033,14.8901538 9.81992058,14.7140769 L9.8172256,14.7167692 L3.34926962,8.79369231 L3.3519646,8.791 C3.13690507,8.59392308 3,8.31392308 3,8 C3,7.68553846 3.13690507,7.40553846 3.3519646,7.20846154 L3.34926962,7.20630769 L9.8172256,1.28323077 L9.81992058,1.28538462 C10.0118033,1.10984615 10.2651315,1 10.5459486,1 C11.1410006,1 11.6239413,1.48192308 11.6239413,2.07692308 C11.6239413,2.39084615 11.4864972,2.67138462 11.2719767,2.86792308 L11.2741327,2.87061538 L5.6734218,8 L11.2741327,13.1288462 L11.2719767,13.1315385 Z M21.152,3.336 L28.604,3.336 C28.118,2.382 27.524,1.482 26.804,0.636 L28.1,0.168 C28.784,1.032 29.396,2.094 29.972,3.336 L36.848,3.336 L36.848,4.632 L34.04,4.632 C33.158,7.476 31.826,9.87 30.062,11.778 C31.97,13.398 34.364,14.73 37.244,15.792 L36.542,16.872 C33.554,15.756 31.106,14.37 29.162,12.696 C27.11,14.586 24.554,15.972 21.494,16.854 L20.81,15.72 C23.834,14.91 26.318,13.632 28.262,11.868 C26.174,9.816 24.734,7.404 23.924,4.632 L21.152,4.632 L21.152,3.336 Z M25.202,4.632 C25.976,7.062 27.29,9.168 29.162,10.968 C30.764,9.222 31.934,7.116 32.69,4.632 L25.202,4.632 Z M46.37,12.066 L41.348,12.066 L41.348,6.594 L52.688,6.594 L52.688,12.066 L47.702,12.066 L47.702,13.326 L54.92,13.326 L54.92,14.478 L47.702,14.478 L47.702,16.728 L46.37,16.728 L46.37,14.478 L39.08,14.478 L39.08,13.326 L46.37,13.326 L46.37,12.066 Z M42.626,9.834 L42.626,10.986 L51.41,10.986 L51.41,9.834 L42.626,9.834 Z M51.41,8.826 L51.41,7.674 L42.626,7.674 L42.626,8.826 L51.41,8.826 Z M42.968,2.688 L40.25,2.688 L40.25,1.554 L46.208,1.554 C46.064,1.122 45.902,0.708 45.722,0.348 L47.108,0.132 C47.288,0.564 47.45,1.032 47.63,1.554 L53.75,1.554 L53.75,2.688 L51.086,2.688 L50.438,4.362 L54.686,4.362 L54.686,5.478 L39.332,5.478 L39.332,4.362 L43.634,4.362 L42.968,2.688 Z M44.948,4.362 L49.106,4.362 L49.736,2.688 L44.282,2.688 L44.948,4.362 Z M70.148,7.404 L70.148,10.932 L61.166,10.932 L61.166,12.174 L70.976,12.174 L70.976,16.8 L69.698,16.8 L69.698,16.044 L61.166,16.044 L61.166,16.782 L59.87,16.782 L59.87,7.404 L70.148,7.404 Z M61.166,14.892 L69.698,14.892 L69.698,13.218 L61.166,13.218 L61.166,14.892 Z M61.166,9.888 L68.888,9.888 L68.888,8.448 L61.166,8.448 L61.166,9.888 Z M72.632,5.226 L72.632,8.484 L71.372,8.484 L71.372,6.342 L58.628,6.342 L58.628,8.484 L57.368,8.484 L57.368,5.226 L64.496,5.226 C64.316,4.794 64.136,4.416 63.938,4.056 L65.198,3.84 L65.09,3.768 C65.954,2.688 66.566,1.518 66.962,0.222 L68.204,0.492 C68.078,0.87 67.952,1.23 67.808,1.59 L73.01,1.59 L73.01,2.724 L69.806,2.724 C70.184,3.228 70.49,3.696 70.706,4.128 L69.554,4.56 C69.23,3.912 68.852,3.3 68.42,2.724 L67.286,2.724 C66.962,3.336 66.584,3.912 66.188,4.452 L65.216,3.858 C65.414,4.272 65.612,4.722 65.792,5.226 L72.632,5.226 Z M59.528,2.724 C59.096,3.426 58.628,4.074 58.088,4.668 L56.954,3.948 C58.034,2.832 58.826,1.572 59.33,0.204 L60.572,0.474 C60.428,0.87 60.266,1.23 60.122,1.59 L64.946,1.59 L64.946,2.724 L61.922,2.724 C62.318,3.264 62.66,3.786 62.912,4.272 L61.724,4.722 C61.4,4.038 61.004,3.372 60.554,2.724 L59.528,2.724 Z M81.488,1.014 L90.29,1.014 L90.29,9.33 L86.546,9.33 L86.546,11.454 L90.596,11.454 L90.596,12.678 L86.546,12.678 L86.546,15.018 L91.262,15.018 L91.262,16.26 L80.426,16.26 L80.426,15.018 L85.25,15.018 L85.25,12.678 L81.182,12.678 L81.182,11.454 L85.25,11.454 L85.25,9.33 L81.488,9.33 L81.488,1.014 Z M89.048,8.178 L89.048,5.748 L86.546,5.748 L86.546,8.178 L89.048,8.178 Z M85.25,8.178 L85.25,5.748 L82.73,5.748 L82.73,8.178 L85.25,8.178 Z M82.73,4.614 L85.25,4.614 L85.25,2.166 L82.73,2.166 L82.73,4.614 Z M86.546,2.166 L86.546,4.614 L89.048,4.614 L89.048,2.166 L86.546,2.166 Z M75.134,6.972 L77.096,6.972 L77.096,2.706 L74.882,2.706 L74.882,1.482 L80.624,1.482 L80.624,2.706 L78.428,2.706 L78.428,6.972 L80.408,6.972 L80.408,8.214 L78.428,8.214 L78.428,12.3 C79.112,12.066 79.76,11.814 80.408,11.526 L80.408,12.786 C78.752,13.47 76.97,14.046 75.062,14.514 L74.738,13.272 C75.53,13.128 76.322,12.948 77.096,12.732 L77.096,8.214 L75.134,8.214 L75.134,6.972 Z" id="形状结合"></path></g></g></g></svg>
					</a>
				</div>
				<div class="article-bar__input-box">
					<input maxlength="100" placeholder="请输入文章标题（5~100个字）" class="article-bar__title article-bar__title--input text-input" value="${workInfo.title}">
				    <span class="article-bar__number default"><span class="">0</span>/100</span>
				    <span class="article-bar__number tip"  style="display: none;">还需要输入-1个字</span>
				</div>
				<div class="article-bar__user-box flex flex--row">
					<button type="button" class="btn btn-save">保存草稿</button>
					<button type="button" class="btn btn-publish">发布文章</button>
				</div>
			</div>
		</div>
		<div class="md-editor">
			<div id="md-container">
			    <textarea id="htmlContent" style="display: none;">${workText.wcontent!}</textarea>
			    <textarea id="textContent"></textarea>
		    </div>
		</div>
		<div class="notice-box" style="display: none;">
			<div>
				<i class="mr8 notice-icon type-error"></i>
				<span class="notice">文章内容不能为空</span>
			</div>
		</div>	
	<div class="modal-dialog-wrapper modal-article-pushlish-wrp">
			<div class="modal-dialog-mask"></div>
			<div class="mod-dialog mod-dialog-large">
				<div class="modal-dialog-inner">
					<div class="modal-dialog-content">
					<input type="hidden" id="article-value" value="${id!}">
					<input type="hidden" id="article-summary-path" value="${workInfo.url!}">
						<div class="article-content">
							<button type="button"class="mod-dialog-close" >
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
							</button>
							<h3 class="modal-dialog-title">发布文章</h3>
							<div class="form-native">
								<svg t="1552465022197" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8301" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" class="icon icon-error"><path d="M512.874667 938.474667c-235.434667 0-426.261333-190.848-426.261334-426.261334 0-235.434667 190.848-426.261333 426.261334-426.261333s426.261333 190.848 426.261333 426.261333c-0.021333 235.413333-190.848 426.261333-426.261333 426.261334z m0-85.248c188.352 0 341.013333-152.682667 341.013333-341.013334 0-188.352-152.661333-341.013333-341.013333-341.013333S171.861333 323.861333 171.861333 512.213333c0 188.330667 152.661333 341.013333 341.013334 341.013334z m-42.645334-511.530667a42.624 42.624 0 1 1 85.290667 0v204.586667a42.666667 42.666667 0 0 1-85.290667 0v-204.586667zM512.874667 725.333333a42.666667 42.666667 0 1 1 0.042666-85.290666A42.666667 42.666667 0 0 1 512.874667 725.333333z" fill="" p-id="8302"></path></svg>
								<span>请勿发布涉及政治、广告、营销、翻墙、违反国家法律法规等内容</span>
							</div>
							<div class="form-entry flex flex-col form-cover-desc-box">
								<div class="cover-desc-title setting-group__title">封面和摘要</div>
								<div class="cover-desc-cont cover-desc-cont-main">
									<div class="form-cover-box setting-group__cover">
										<div class=" form-cover_btn_area">
											<i class="icon-add_css"></i>
											<span class="btn-text">选择封面</span>
											<form id="form_upload" method="post"  enctype="multipart/form-data" >
											<input type="file" name="file" class="input-fileUpload" onchange="upload_file()">
											<input type="hidden" id="input-fileUpload-path">
											
											</form>
										</div>
										 <!-- 封面加载之前的loading状态 -->
										<div class="select-cover__loading__mask js_cover_loading">
				                          <i class="select-cover__loading weui-desktop-loading"></i>
				                        </div>
				                        <!-- 默认隐藏,选择图片后显示 -->
				                        <div class="select-cover__preview js_cover_preview first_appmsg_cover" style="display: none;">
				                        	<div class="select-cover__preview__mask js_cover_btn_area" >
				                                <a href="javascript:;" class="icon20_common edit_media_white js_modifyCover" onclick="return false;">修改</a>
				                            </div>
				                            <input type="hidden" id="input-fileUpload-path">
				                        </div>
									</div>
									<div class="form-dsc-box setting-group__abstract">
										<span class="frm_textarea_box form-texarea-box">
											<textarea  class="frm_textarea" id="js_description" placeholder="必填，摘要是文章主体内容的介绍和总结，能帮助读者快速了解内容"  maxlength="120">${workInfo.summary}</textarea>
											<em class="frm_input_append frm_counter">1/120</em>
										</span>
									</div>
									<div class="frm_msg fail js_cover_error js_error_msg" style="display: none;">必须插入一张图片</div>
								</div>
							</div>
							<div class="form-entry flex form-tag-box">
								<label class="form-entry__label">文章标签:</label>
								<div>
									<div class="mark_selection">
										<div class="mark_selection_title_el_tag">
										   @for(l in lList!){
											    @if(lLP.first ){
											    <span>
											    @}
										     <span class="el-tag el-tag--light mark_selection_box_el_tag ">
										        ${l.tag}
										        <i class="el-tag__close el-icon-close"></i>
										     </span>
											   @if(lLP.last){
											   </span>
											   @}
										   @}
										    
											<button class="tag__btn-tag">
												<svg width="200px" height="200.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon"><path fill="currentColor" d="M464.32 464.341333V178.368a47.658667 47.658667 0 1 1 95.338667 0v285.973333h285.952a47.658667 47.658667 0 0 1 0 95.317334H559.658667v285.952a47.68 47.68 0 0 1-95.338667 0V559.658667H178.368a47.658667 47.658667 0 1 1 0-95.317334h285.952z"></path></svg>
												 添加文章标签        
											</button>
										</div>
										<div class="mark_selection_box" style="display: none;">
											<div class="tag__options-content">
											<div class="mark_title">标签</div>
											<div class="mark_selection_box_header">
												<input type="text"autocomplete="off" placeholder="请输入文字搜索，Enter键入可添加自定义标签" class="el-input__inner" maxlength="16"/>
												<em class="mark-frm-counter">0/16</em>
											</div>
											<div class="tag__options-txt">
												<span style="margin-right: 11px;">最多选择5个标签</span>
											</div>
											<div class="tag-option-hd">
												<h3>历史标签</h3>
											</div>
											<div class="tag__options-list">
												@for(label in labelList!){
												<div class="tag__option-box">
													<label class="tag__option-label">
														<input type="checkbox" class="tag__option-chk" value="Java"> 
														<i for="chk01" class="tag__option-icon"></i>
														<span class="spanIsAgree" id="${label.id}">${label.tag}</span>
													</label>
												</div>
												@}	
												
											</div>
											
											<button type="button" class="modal__close-button button tag-close-btn">
												<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
											</button>
										</div>
										</div>
									</div>
								</div>
							</div>
							<div class="form-entry flex form-tag-box">
								<label class="form-entry__label">分类专栏:</label>
								<div class="form-entry__field">
									<div class="tag__box">
										<input type="hidden" name="categories">
										<div class="flex-box">
											<div class="tag__item-list">
											  @for(c in cList!){
												  <div class="tag__item-box">
												  	<span contenteditable="false" class="tag__name" style="display: block;">${c.column}</span>
												  	<button class="tag__btn-tag-delete">
												  		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
												  	</button>
												   </div>
											  @}
												<button class="tag__btn-tag">
													<svg width="200px" height="200.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon"><path fill="currentColor" d="M464.32 464.341333V178.368a47.658667 47.658667 0 1 1 95.338667 0v285.973333h285.952a47.658667 47.658667 0 0 1 0 95.317334H559.658667v285.952a47.68 47.68 0 0 1-95.338667 0V559.658667H178.368a47.658667 47.658667 0 1 1 0-95.317334h285.952z"></path></svg>
													 新建分类专栏
												</button>
											</div>
										</div>
										<div class="tag__options-content">
											<div class="tag__options-txt">
												<span style="margin-right: 11px;">最多选择3个分类专栏</span>
												<!-- <font>#为二级分类</font> -->
											</div>
											<div class="tag__options-list">
											    @for(col in colList!){
												<div class="tag__option-box">
													<label class="tag__option-label">
														<input type="checkbox" class="tag__option-chk" value="Java"> 
														<i for="chk01" class="tag__option-icon"></i>
														<span class="spanIsAgree" id="${col.id}">${col.column}</span>
													</label>
												</div>
												@}												
												
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="inline-box">
								<div class="form-entry flex">
									<label  class="form-entry__label">文章类型：</label> 
									<div class="form-entry__field">
										<select class="textfield" name="articleType" id="articleType">
											<option value="" selected="selected">请选择</option>
											<option value="1">原创</option> 
											<option value="0">非原创</option>
										</select>
									</div>
									<span class="notice">*</span>
								</div>
							</div>
						    <div class="form-entry flex form-entry__field-switch-box overflow-unset form-entry-marginBottom plan">
						    	<label class="form-entry__label">发布形式：</label>
						    	<div class="form-entry__field">
						    		<div class="switch-box">
						    			<input type="radio" name="modality" id="public" value="2"   class="form-control form-control-sm chk-switch">
						    			<label for="public" class="lab-switch">公开</label>
						    			<input type="radio" name="modality" id="private" value="1"  class="form-control form-control-sm chk-switch">
						    			<label for="private" class="lab-switch">私密</label>
						    		</div>
						    	</div>
						    </div>
						    <div class="modal__button-bar">
						    	<button class="button btn-cancel">取消</button>
						    	<button class="button btn-b-blue pulish-article-btn">发布文章</button>
						    </div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
@}
